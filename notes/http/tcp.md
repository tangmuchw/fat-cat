# TCP

## 概念

> 位于传输层， 提供可靠的字节流服务

- 面向连接、可靠的基于字节流的传输协议
- 将应用层的数据分割成报文段并发送给目标节点的 TCP 层
- 每个数据包都有相对应的序号，对方收到后就发送 ACK 确认，没收到就重传
- 使用校验和检测传输过程中是否出现错误

## 百万并发 TCP 连接如何优化？

> CDN，服务器集群

- 一个 TCP 连接标识符有：src-ip, src-port, dest-ip, dest-port, protocol = TCP。对于服务器来说，src-port 一般是固定的，比如 HTTP（80），但是 dest-ip 和 dest-port 没有限制

## TCP 数据流是怎么样的？

> 按照分组数量计算，约有一般的 TCP 包涵**成块数据（如 FTP、电子邮箱）**，另一半则包含**交互数据（如 telnet 和 rlogin）**

## 什么是 TCP 零拷贝技术？

> 在网卡驱动程序和协议之间没有数据拷贝的过程，以减少系统资源占用和节省处理时间

- 在通常的 TCP/IP 实现中，网卡驱动程序和协议相对独立。在发送和接受数据时候都存在一次网卡驱动程序和协议栈之间的数据拷贝
- 参考爱学术[TCP/IP 协议的零拷贝和简化实现](https://www.ixueshu.com/document/e5e098afa0492a1e.html)

## 拥塞预防以及控制

> 常见的是 ip 网关在连接不同带宽时经常因为差别性，导致拥塞崩溃，为此 tcp 引起很多机制来解决整个问题

- 流量控制：就是根据出场景去限定服务器或者用户的窗口大小

- 慢启动

  > 慢启动存在的原因是虽然有个流量控制，但是在**连接初期，不清楚双方的窗口大小**，所以从初始字段指数级增长达到或者超过其峰值 => **也就是说，不可能开始就直接使用宽带的最大值**

- 拥塞预防

  > 拥塞预防，指的是通过慢启动达到或者超过宽带最大值之后，直接减倍，然后变成小数量的线性增长，直到达到其阈值。

- 带宽延迟积

  > 数据链路的容量预期端到端的延迟乘积

- 队首阻塞
  > TCP 的传输机制，它会每个分组都携带唯一的序列号触发，而却所有的分组必须按照顺序到达接收端，如果不是按顺序的，或者丢失数据，也就是所谓的丢包，那么后续收到的必须等待丢失的部分全部达到才能访问数据，这种效应就是队首阻塞
