# script 标签放在 header 里和放在 body 底部有什么区别

-   首先，加载顺序方面，将 script 标签放在 header 中会导致浏览器在解析 HTML 时立即加载和执行脚本，这可能会阻塞页面的渲染，因为浏览器必须等待脚本加载和执行完成后才能继续构建 DOM 树。相反，将脚本放在 body 底部会使浏览器先渲染页面内容，然后再加载和执行脚本，避免了阻塞渲染的情况 ‌12。

-   其次，性能影响方面，将脚本放在 body 底部可以改善页面加载性能。当脚本放在 header 中时，浏览器必须在加载脚本前先下载并执行它们，这可能导致页面加载时间延长。而将脚本放在 body 底部可以让页面内容更快地呈现给用户，提高感知性能。

-   最后，依赖关系方面，如果脚本依赖于页面的其他资源（如 CSS、图片等），将脚本放在 header 中可以确保在加载和执行脚本之前已经加载了所需的资源，避免由于缺少依赖资源而导致的错误。然而，使用现代的异步加载技术（如 async 或 defer 属性）可以将脚本放在 body 底部并仍然控制脚本的加载顺序和依赖关系 ‌

## defer

该属性用来设置<script>引用的外部脚本在文档完成解析后，触发 DOMContentLoaded 事件之前执行，属性值为 true(defer)/false，默认为 false，设置为 true 时可简写为只写 defer。

浏览器在解析 HTML 文档时，如果遇到 <script>，便会停下对 HTML 文档的解析，转而去处理脚本。如果脚本是内联的，浏览器会先去执行这段内联的脚本，如果是外链的，那么先会去加载脚本，然后再执行。等到脚本执行结束后，浏览器才会继续解析 HTML 文档。

但如果页面中存在设置了 defer="defer"属性并且是通过 src 引用的外部脚本的<script>，则该脚本不会阻碍文档的解析，只会在文档解析的同时去加载脚本信息，当文档解析完成后，暂时阻止 DOMContentLoaded 事件的执行，去执行已经加载好的脚本信息，如果此时脚本还未加载完成，则会等待脚本加载完成后，再执行该脚本。执行完成后，再触发 DOMContentLoaded 事件。

如果不是通过 src 引用的外部脚本，而是直接在<script>标签书写内嵌脚本，则设置 defer 属性无效。除此之外，defer 属性对模块脚本也不起作用，因为模块脚本默认 defer。

## async

> **async 的优先级 高于 defer**

> 该属性用来设置<script>引用的外部脚本异步加载，不阻塞 HTML 文档的解析，属性值为 true(async)/false，默认为 false，设置为 true 时可简写为只写 async。

对于普通脚本，如果设置该属性，那么该脚本将会并行加载，不阻碍 HTML 文档的解析，当加载完成后，如果此时文档还没解析完成，则会终止解析，先执行该脚本，执行结束后再继续解析；如果此时文档已经解析完成了，那就是立即执行该脚本。所以设置**该属性的外部脚本的执行时机并不确定**，根据网络状况可能会在 DOMContentLoaded 事件之前，也有可能会在 DOMContentLoaded 事件之后。所以在脚本里面可能会获取不到在 HTML 中定义的元素，因为此时元素可能还没有被解析。
